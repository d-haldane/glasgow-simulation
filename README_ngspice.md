## NGSpice notes for partial simulation of glasgow
### Sat Nov 21 01:53:54 PST 2020

Run NGspice on linux machine at 192.168.2.38
The simulation is stored in /home/tomacorp/jitx/ngspice/ggsim
First export the display:
```
export DISPLAY=export DISPLAY=192.168.2.38:0.0
```
X-Windows already running with xhost perms set.

Command line looks like:
```
ngspice -a --output=ggsim.txt -b ggsim.cir
```

This was run on NGSpice on the tomacorp linux server at 192.168.2.38

The simulation there is stored in /home/tomacorp/jitx/ngspice/ggsim

First export the display:
```
export DISPLAY=192.168.2.38:0.0
```
On the local workstation, have X-Windows already running with xhost permissions set.

Run ngspice on the command line with this:
```
ngspice -a --output=ggsim.txt -b ggsim.cir
```

The contents of the original ggsim.cir circuit needed to be changed to fix some problems
that NGSpice had simulating it.

Here is the original:

```
*** auto-generated by jitpcb ***
.title jitpcb-generated-spice

* component Capacitor_SMD:C_0402_1005Metric 
.subckt  subckt20178 20136 20137
    C8    20136    20137     1.0e-07
.ends
* component Connector_USB:USB_Micro-B_Molex_47346-0001 
.subckt  subckt20176 20126 20127 20128 20129 20130 20131
    V1  20126    20130   EXP(0 5 200u 200u 20 20)
    RPU  20128    20126   50
    RDK  20127    20130   50
    RRSH  20130    20131   1
    RNC1  20129    20130   100MEG
.ends
* component Capacitor_SMD:C_0402_1005Metric 
.subckt  subckt20177 20133 20134
    C13    20133    20134     1.0e-07
.ends
* component Package_TO_SOT_SMD:SOT-23-6 
.subckt  subckt20180 20142 20143 20144 20145 20146 20147
    RON  20144    20145   0.097
    RDK  20145    20143   76K
    DA  20146    20145   DESD
    DB  20143    20146   DESD
    DC  20147    20145   DESD
    DD  20143    20147   DESD
    RPDA  20146    20145   10MEG
    RPDC  20147    20145   10MEG
    DZENER  20143    20145   D_ZENER
    DENU  20142    20144   DESD
    DEND  20143    20142   DESD
    RRPDENU  20144    20142   100MEG
    .model DESD D RS=1 N=1.5
    .model D_ZENER D RS=1 N=1.5 BV=6 IBV=1m
.ends
* component Capacitor_SMD:C_0402_1005Metric 
.subckt  subckt20179 20139 20140
    C26    20139    20140     4.7e-06
.ends
X20120 1 2 3 4 0 5  subckt20176 ;instance: J1
X20121 probe_20181 probe_20182  subckt20177
X20122 probe_20183 probe_20184  subckt20178
X20123 probe_20185 probe_20186  subckt20179
X20125 1 0 1 6 2 3  subckt20180 ;instance: U15
Vprobe_C13_1 5 probe_20181 DC 0
Vprobe_C13_2 0 probe_20182 DC 0
Vprobe_C8_1 1 probe_20183 DC 0
Vprobe_C8_2 0 probe_20184 DC 0
Vprobe_C26_1 6 probe_20185 DC 0
Vprobe_C26_2 0 probe_20186 DC 0
*** operating point of C13
.measure tran C13_v_max  MAX par('v(5) - v(0)')
.measure tran C13_v_min  MIN par('v(5) - v(0)')
.measure tran C13_i_peak MAX par('abs(i(Vprobe_C13_1))')
.measure tran C13_i_rms  RMS par('i(Vprobe_C13_1)')
*** operating point of C8
.measure tran C8_v_max  MAX par('v(1) - v(0)')
.measure tran C8_v_min  MIN par('v(1) - v(0)')
.measure tran C8_i_peak MAX par('abs(i(Vprobe_C8_1))')
.measure tran C8_i_rms  RMS par('i(Vprobe_C8_1)')
*** operating point of C26
.measure tran C26_v_max  MAX par('v(6) - v(0)')
.measure tran C26_v_min  MIN par('v(6) - v(0)')
.measure tran C26_i_peak MAX par('abs(i(Vprobe_C26_1))')
.measure tran C26_i_rms  RMS par('i(Vprobe_C26_1)')

*transient analysis for 20ms, step size 0.02ms
*.tran 0.02ms 15m
* Plot commands for interactive mode
*.control
*run
*plot v()
*.endc
.end
```

For some unknown reason the .measure statements cause NGSpice to dump core.
Here is what it was changed to:

```
*** auto-generated by jitpcb ***
.title jitpcb-generated-spice
* component Package_TO_SOT_SMD:SOT-23-6
*
.subckt  subckt17855 17817 17818 17819 17820 17821 17822
RON  17819    17820   0.097
RDK  17820    17818   76K
DA  17821    17820   DESD
DB  17818    17821   DESD
DC  17822    17820   DESD
DD  17818    17822   DESD
RPDA  17821    17820   10MEG
RPDC  17822    17820   10MEG
DZENER  17818    17820   DZENER
DUP  17817    17819   DESD
DDN  17818    17817   DESD
RRPDENU  17819    17817   100MEG
.ends
*
* component Capacitor_SMD:C_0402_1005Metric
.subckt  subckt17854 17814 17815
C26    17814    17815     4.7e-06
.ends
* component Capacitor_SMD:C_0402_1005Metric
.subckt  subckt17853 17811 17812
C8    17811    17812     1.0e-07
.ends
* component Connector_USB:USB_Micro-B_Molex_47346-0001
.subckt  subckt17851 17801 17802 17803 17804 17805 17806
V1  17801    17805   EXP(0 5 200u 200u 20 20)
RPU  17803    17801   50
RDK  17802    17805   50
RRSH  17805    17806   1
RNC1  17804    17805   100MEG
.ends
* component Capacitor_SMD:C_0402_1005Metric
.subckt  subckt17852 17808 17809
C13    17808    17809     1.0e-07
.ends
X17800 1 0 1 6 2 3 subckt17855
X17795 1 2 3 4 0 5 subckt17851
X17796 probe17856 probe17857 subckt17852
X17797 probe17858 probe17859 subckt17853
X17798 probe17860 probe17861 subckt17854
VprobeC131 5 probe17856 DC 0
VprobeC132 0 probe17857 DC 0
VprobeC81 1 probe17858 DC 0
VprobeC82 0 probe17859 DC 0
VprobeC261 6 probe17860 DC 0
VprobeC262 0 probe17861 DC 0
*
.model DESD D RS=1 N=1.5
.model DZENER D RS=1 N=1.5 BV=6 IBV=1m
.options savecurrents filetype=ascii
.save all
.tran 1u 10m 0 10u
.tran 1u 10m
.control
run
.endc
.end
```

Run it with:
ngspice -a --output=ggsim.txt -b ggsim.cir

To see a graph, run:
ngnutmeg ggsim.raw

To show the available voltages and currents at the ngnutmeg prompt:
display

To plot something at the ngnutmeg prompt:
plot v(3)

Run it with:
```
ngspice -a -b --output=ggsim2.txt -r ggsim2.raw ggsim2.cir
```

To see a graph, run:
```
ngnutmeg ggsim.raw
```

The ASCII output file format is human readable.
The last timepoint at the end of the file is useful for stress analysis.
The power dissipation of all components can be calculated at this timepoint.
The sum of the power in the power supplies should be equal and opposite to the power in the other components.
Any power in inductors and capacitors means that the circuit has not settled to a steady value.
This could be because the turn-on transient has not settled, or it could be that the circuit is oscillating.

To show the available voltages and currents at the ngnutmeg prompt:
```
display
```

To plot something at the ngnutmeg prompt:
```
plot v(3)
```

